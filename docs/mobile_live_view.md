# EXITON Mobile Live View - 使い方ガイド

## 目的

**スマホから EXITON の Live Signal を閲覧するための簡易ビュー**

PC用の開発者向けダッシュボード（`dev_dashboard.py`）とは別に、スマホでの閲覧に特化したシンプルなインターフェースを提供します。

## 特徴

- 📱 **モバイル最適化**: スマホでの閲覧を前提としたレイアウト
- 🔄 **自動更新**: 60秒ごとに自動的にシグナルを更新
- 🎯 **シンプル**: 必要最小限の情報のみを表示
- 🧠 **Explainability対応**: 各シグナルの根拠（指標値・条件・信頼度）を表示

## 起動方法

### 前提条件

1. FastAPIバックエンドが起動していること
2. Pythonの仮想環境がアクティブであること（使用している場合）

### ステップ1: バックエンドの起動

別のターミナルウィンドウで：

```bash
# プロジェクトルートに移動
cd /path/to/ai-signal-chart

# バックエンドを起動
uvicorn backend.main:app --host 0.0.0.0 --port 8001

# または
python -m backend.main
```

バックエンドが `http://localhost:8001` で起動していることを確認してください。

### ステップ2: モバイルビューの起動

新しいターミナルウィンドウで：

```bash
# プロジェクトルートに移動
cd /path/to/ai-signal-chart

# Streamlit モバイルビューを起動
streamlit run mobile_live_view.py
```

### ステップ3: アクセス

ブラウザで以下のURLにアクセス：

- **ローカル（PC）**: `http://localhost:8501`
- **同一ネットワークのスマホ**: `http://<Mac miniのIPアドレス>:8501`

例: `http://192.168.1.100:8501`

## バックエンドURLの指定方法

デフォルトでは `http://localhost:8001` に接続しますが、環境変数で変更可能です。

### 環境変数での指定

```bash
# 環境変数を設定して起動
export BACKEND_URL=http://192.168.1.100:8001
streamlit run mobile_live_view.py
```

### デフォルト値

コード内のデフォルト値：

```python
BACKEND_URL = os.environ.get("BACKEND_URL", "http://localhost:8001")
```

## 画面説明

### メイン画面

1. **ヘッダー**
   - タイトル: "📱 EXITON Live Signals"
   - 自動更新間隔の表示

2. **シグナルカード** （各銘柄ごと）
   
   **1行目**:
   - 銘柄シンボル（例: AAPL）- 左側、大きく表示
   - サイド（BUY / SELL）- 右側、色付きバッジ
     - BUY: 緑色
     - SELL: 赤色

   **2行目**:
   - 現在価格（例: $189.50）
   - シグナル時刻（ローカルタイム）
   
   **3行目**:
   - reason_summary - シグナル発生理由の短いサマリ
   
   **4行目**:
   - 信頼度メーター（プログレスバー）
   - 信頼度パーセンテージ（例: 78%）
     - 70%以上: 緑色
     - 50-70%: 黄色
     - 50%未満: 赤色

3. **詳細情報** （各カードの `📊 詳細情報` expanderをタップ）
   
   - **指標値セクション**:
     - short_ma、long_ma、close など
     - 2列のグリッドで表示
   
   - **発火条件セクション**:
     - チェックマーク付きリスト
     - 例: "Short MA (9) > Long MA (21)"
   
   - **信頼度スコア**:
     - 数値表示（例: 0.72）

### サイドバー（設定）

左上のメニュー（☰）をタップして開く：

1. **銘柄入力欄**
   - カンマ区切りでシンボルを入力
   - 例: `AAPL,MSFT,GOOGL`

2. **戦略選択**
   - プルダウンメニュー
   - オプション: ma_cross, rsi_mean_reversion, macd_trend

3. **バックエンドURL表示**
   - 現在接続しているバックエンドのURL

4. **手動更新ボタン**
   - 自動更新を待たずに即座に更新

## エラーメッセージ

### 接続エラー

```
🔌 バックエンドに接続できません: http://localhost:8001
バックエンドが起動していることを確認してください。
```

**対処法**:
- バックエンドが起動しているか確認
- ファイアウォールの設定を確認
- BACKEND_URL環境変数を確認

### タイムアウトエラー

```
⏱️ タイムアウト: バックエンドの応答が遅すぎます
```

**対処法**:
- ネットワーク接続を確認
- バックエンドのログを確認してエラーがないか確認

### シグナルなし

```
ℹ️ 現在アクティブなシグナルはありません
```

これはエラーではなく、指定した銘柄に対して現在アクティブなシグナルがない正常な状態です。

## 想定する今後の拡張

### 1. シンボルフィルタ機能
- BUYシグナルのみ表示
- SELLシグナルのみ表示
- 特定の信頼度以上のみ表示

### 2. 戦略別タブ
- 複数の戦略を同時に実行し、タブで切り替え
- 例: MA CrossタブとRSIタブ

### 3. アラート・通知機能
- 新しいBUYシグナルが出たら通知
- Pushparation連携
- メール通知
- LINE通知

### 4. ポートフォリオ管理
- 保有銘柄の管理
- 推奨売買アクションの表示
- P&Lトラッキング

### 5. ダークモード切り替え
- ライトモード/ダークモードの選択

### 6. カスタマイズ可能な更新間隔
- ユーザーが自動更新間隔を設定可能（30秒〜5分）

### 7. シグナル履歴
- 過去のシグナルの履歴を表示
- パフォーマンストラッキング

### 8. 複数戦略の同時表示
- 1つの銘柄に対して複数の戦略のシグナルを比較

## トラブルシューティング

### Streamlitが起動しない

```bash
# Streamlitがインストールされているか確認
pip list | grep streamlit

# なければインストール
pip install streamlit
```

### ポートが既に使用されている

```bash
# 別のポートで起動
streamlit run mobile_live_view.py --server.port 8502
```

### スマホからアクセスできない

1. Mac miniとスマホが同じWi-Fiネットワークに接続されているか確認
2. Mac miniのIPアドレスを確認:
   ```bash
   ifconfig | grep "inet "
   ```
3. Mac miniのファイアウォール設定を確認
4. Streamlitを `--server.address 0.0.0.0` で起動:
   ```bash
   streamlit run mobile_live_view.py --server.address 0.0.0.0
   ```

## セキュリティに関する注意

- このビューは現在**認証機能がありません**
- ローカルネットワーク内での使用を想定しています
- 外部からのアクセスには Cloudflare Tunnel の使用を推奨します（詳細は `docs/deploy/cloudflare_tunnel_mobile_view.md` を参照）
- パスワード保護が必要な場合は、Streamlitの認証機能を追加してください

## 関連ドキュメント

- [Cloudflare Tunnel設定ガイド](../deploy/cloudflare_tunnel_mobile_view.md) - 外部アクセス設定
- [Explainability Test Plan](../tests/explainability_test_plan.md) - シグナル説明機能の詳細
- [Backend API仕様](../../02API_SPEC.md) - APIエンドポイントの詳細
