# SAAS_STANDARD_v0.1.md
EXITON 内部 SaaS 設計標準 v0.1
=============================

本ドキュメントは、EXITON プロジェクト（自動投資システムを含む）が
将来的にクラウドSaaSとして提供されることを見据え、
**共通して守るべき設計標準・方針** を定義する。

特定サービス（自動投資システム）の仕様ではなく、
EXITONブランド全体に共通する「社内標準」である。

---

## 1. 環境構成（Environments）

### SAAS-001 環境レイヤ
- 原則として、以下の3環境を区別する：
  - `dev`：開発用（個人・チームの検証）
  - `staging`：本番相当の事前検証用
  - `prod`：本番環境
- 各環境は、可能な限り以下を分離する：
  - DB（別インスタンス）
  - ストレージ（別バケット）
  - 認証設定

### SAAS-002 デプロイ先の例
- フロントエンド：Vercel / Netlify / Cloudflare Pages
- バックエンドAPI：Railway / Render / Fly.io / Supabase Functions 等
- DB：Supabase / Neon / PlanetScale 等

---

## 2. マルチテナンシモデル

### SAAS-010 シングルテナントから開始
- 初期バージョンでは、実質的に「シングルテナント」構成でよい。
  - 1インスタンス = ほぼ単一の管理者とユーザーグループ
- 将来のマルチテナント（ユーザー毎の隔離）を見据え、
  - DBスキーマ設計時に `tenant_id` カラム等を追加しやすい構成を意識する。

### SAAS-011 ユーザーデータの隔離
- 将来的にマルチテナントに移行する場合：
  - テナント間でデータが混線しないこと
  - 退会時にデータ削除が可能であること
を最優先に設計する。

---

## 3. 設定・構成管理

### SAAS-020 環境変数による設定
- APIキー・DB接続情報・機能フラグ等は、
  - すべて環境変数で設定し、
  - `.env` などからロードする形式とする。
- ソースコードに機密情報を埋め込むことは禁止。

### SAAS-021 Feature Flag
- 新機能は可能な限り「機能フラグ」で ON/OFF を切り替え可能にする。
- 不安定な機能を本番にデプロイしやすくしつつ、
  ユーザーへの影響を制御する。

---

## 4. セキュリティベースライン

### SAAS-030 認証・認可
- 認証基盤は自前実装ではなく、信頼性の高い外部サービスを優先する：
  - Supabase Auth
  - Auth0
  - Firebase Auth 等
- 将来的な要件：
  - パスワードは bcrypt/argon2 等でハッシュ化（外部サービスが対応）
  - 2FA の導入可能性を残す
  - パスワードリセットは必ずメールによる本人確認を伴う

### SAAS-031 通信暗号化
- `prod` 環境は原則 HTTPS のみを許可する。
- HTTP から HTTPS へのリダイレクトを強制する。

### SAAS-032 ログにおける機密情報
- パスワード・生APIキー・クレジットカード番号等は、
  - ログに一切出力しない。
- トークン類はマスクして記録する。

---

## 5. ログ・モニタリング・アラート

### SAAS-040 ログ集約
- 本番環境では、ログを一箇所に集約することが望ましい：
  - 例：Sentry / Better Stack / Datadog 等
- 最低限、以下を記録する：
  - エラー発生時刻
  - エラー種別
  - スタックトレース（内部用）

### SAAS-041 アラート
- 致命的エラーが一定回数以上発生した場合：
  - Slack / Email / Discord 等で通知される仕組みを検討する。

---

## 6. データ保護・ライフサイクル

### SAAS-050 データ削除ポリシー
- ユーザーが退会した場合、
  - 個人情報は一定期間後に削除する（法令に準拠）。
- バックテスト結果などの匿名化可能なデータは、
  - 分析用途に用いる可能性もあるが、
  - その場合でも個人を特定できない形にする。

### SAAS-051 バックアップ
- DB・ストレージについて、
  - 定期的なバックアップポリシーを定める。
- 重要度に応じて RPO/RTO を検討する（将来）。

---

## 7. デプロイ・リリース管理

### SAAS-060 バージョニング
- Webアプリは「継続デリバリ」が前提だが、
  - 主要機能にはバージョン番号を付与する（例：戦略エンジン）。

### SAAS-061 リリースノート
- 本番にユーザーへ影響する変更を行う場合：
  - `CHANGELOG.md` に概要をまとめる。
- 破壊的変更（breaking changes）がある場合：
  - 事前にアナウンスできる仕組みを検討する。

---

以上。
